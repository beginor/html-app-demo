<?xml version="1.0" encoding="utf-8" ?>
<configuration>

    <facilities>
        <facility id="logging"
                  type="Castle.Facilities.Logging.LoggingFacility, Castle.Facilities.Logging"
                  loggingApi="log4net" configFile="log.config" />
    </facilities>

    <properties>
        <database></database>
    </properties>

    <components>
        <!-- Middlewares -->
        <component type="OwinApiHost.Middlewares.ConsoleLogMiddleware,OwinApiHost" />

        <component id="StaticFileOptions" type="Beginor.Owin.StaticFile.StaticFileMiddlewareOptions,Beginor.Owin.StaticFile">
            <parameters>
                <RootDirectory><![CDATA[..\www]]></RootDirectory>
                <DefaultFile>index.html</DefaultFile>
            </parameters>
        </component>

        <component service="Microsoft.Owin.Logging.ILoggerFactory,Microsoft.Owin"
                   type="Beginor.Owin.Logging.CastleLoggerFactory,Beginor.Owin.Logging"
                   inspectionBehavior="declaredonly" />

        <component service="System.Web.Http.ExceptionHandling.IExceptionLogger,System.Web.Http"
                   type="Beginor.Owin.WebApi.Windsor.CastleExceptionLogger,Beginor.Owin.WebApi.Windsor"
                   inspectionBehavior="declaredonly"
                   />

        <component id="identityDataContext" type="WebApi.HibernateContext,WebApi">
            <parameters>
                <connectionString>Data Source=vm-dp2.apac.wan.2020.net;Database=aspnet_identity;User Id=root;Password=1a2b3c4D;</connectionString>
                <assemblyName>WebApi</assemblyName>
            </parameters>
        </component>
        
        <!-- identity message service config -->
        <component id="emailService"
                   service="Microsoft.AspNet.Identity.IIdentityMessageService,Microsoft.AspNet.Identity.Core"
                   type="WebApi.EmailService,WebApi"
                   />
        <component id="smsService"
                   service="Microsoft.AspNet.Identity.IIdentityMessageService,Microsoft.AspNet.Identity.Core"
                   type="WebApi.SmsService,WebApi"
                   />

        <!-- Controllers -->
        <component type="WebApi.Controllers.CategoriesController,WebApi" lifestyle="transient"/>
        <component type="WebApi.Controllers.ProductsController,WebApi" lifestyle="transient"/>
        <component type="WebApi.Controllers.AccountController,WebApi" lifestyle="transient"/>
        <component type="WebApi.Controllers.UsersController,WebApi" lifestyle="transient">
            <parameters>
                <dataContext>${identityDataContext}</dataContext>
            </parameters>
        </component>
    </components>

</configuration>